!function(n){n.module("Jsonapi.config",[]).constant("rsJsonapiConfig",{url:"http://yourdomain/api/v1/",delay:0,unify_concurrency:!0,cache_prerequests:!0}),n.module("Jsonapi.services",[]),n.module("rsJsonapi",["angular-storage","Jsonapi.config","Jsonapi.services"])}(angular);
var Jsonapi;!function(n){var a=function(){function n(){}return n.Params={id:"",include:[]},n.Schema={attributes:{},relationships:{}},n}();n.Base=a}(Jsonapi||(Jsonapi={}));
var Jsonapi;!function(t){var e=function(){function e(t,e,o,n){this.$http=t,this.$timeout=e,this.rsJsonapiConfig=o,this.$q=n}return e.$inject=["$http","$timeout","rsJsonapiConfig","$q"],e.prototype["delete"]=function(t){return this.exec(t,"DELETE")},e.prototype.get=function(t){return this.exec(t,"GET")},e.prototype.exec=function(e,o,n){var i={method:o,url:this.rsJsonapiConfig.url+e,headers:{"Content-Type":"application/vnd.api+json"}};n&&(i.data=n);var r=this.$http(i),s=this.$q.defer(),a=this;return t.Core.Me.refreshLoadings(1),r.then(function(e){a.$timeout(function(){t.Core.Me.refreshLoadings(-1),s.resolve(e)},a.rsJsonapiConfig.delay)},function(e){t.Core.Me.refreshLoadings(-1),console.warn("Jsonapi.Http.exec error =>",e),e.status<=0&&t.Core.Me.loadingsError(),s.reject(e)}),s.promise},e}();t.Http=e,angular.module("Jsonapi.services").service("JsonapiHttp",e)}(Jsonapi||(Jsonapi={}));
var Jsonapi;!function(t){var n=function(){function t(){this.paths=[],this.includes=[]}return t.prototype.addPath=function(t){this.paths.push(t)},t.prototype.setInclude=function(t){this.includes=t},t.prototype.get=function(){var t=[];return this.includes.length>0&&t.push("include="+this.includes.join(",")),this.paths.join("/")+(t.length>0?"?"+t.join("&"):"")},t}();t.PathMaker=n}(Jsonapi||(Jsonapi={}));
var Jsonapi;!function(e){var r=function(){function r(){}return r.json_array2resources_array=function(r,n,t){void 0===t&&(t=!1),n||(n=[]);for(var i=0,a=0,o=r;a<o.length;a++){var s=o[a],u=e.Converter.json2resource(s,!1);t?n[u.id]=u:n[u.type+"_"+u.id]=u,i++}return n},r.json_array2resources_array_by_type=function(e,n){var t={};r.json_array2resources_array(e,t,!1);var i={};return angular.forEach(t,function(e){e.type in i||(i[e.type]={}),i[e.type][e.id]=e}),i},r.json2resource=function(r,n){var t=e.Converter.getService(r.type);if(t)return e.Converter.procreate(t,r);console.warn("`"+r.type+"`","service not found on json2resource()");var i=new e.Resource;return i.id=r.id,i.type=r.type,i},r.getService=function(r){var n=e.Core.Me.getResource(r);return angular.isUndefined(n)&&console.warn("`"+r+"`","service not found on getService()"),n},r.procreate=function(e,r){"type"in r&&"id"in r||console.error("Jsonapi Resource is not correct",r);var n=new e.constructor;return n["new"](),n.id=r.id,n.attributes=r.attributes?r.attributes:{},n.is_new=!1,n},r.build=function(e,n,t){var i={};"included"in e&&(i=r.json_array2resources_array_by_type(e.included,!1)),angular.isArray(e.data)?r._buildResources(e,n,t,i):r._buildResource(e.data,n,t,i)},r._buildResources=function(n,t,i,a){for(var o=0,s=n.data;o<s.length;o++){var u=s[o],c=e.Converter.getService(u.type);u.id in t||(t[u.id]=new c.constructor,t[u.id].reset()),r._buildResource(u,t[u.id],i,a)}},r._buildResource=function(e,n,t,i){n.attributes=e.attributes,n.id=e.id,n.is_new=!1,r.__buildRelationships(e.relationships,n.relationships,i,t)},r.__buildRelationships=function(n,t,i,a){angular.forEach(n,function(n,o){if(!(o in t)&&"data"in n&&(t[o]={data:[]}),n.data)if(a.relationships[o]&&a.relationships[o].hasMany){if(n.data.length<1)return;var s=e.Converter.getService(n.data[0].type);s&&(t[o].data={},angular.forEach(n.data,function(e){var n=r.__buildRelationship(e,i);t[o].data[n.id]=n}))}else t[o].data=r.__buildRelationship(n.data,i)})},r.__buildRelationship=function(e,r){return e.type in r&&e.id in r[e.type]?r[e.type][e.id]:e},r}();e.Converter=r}(Jsonapi||(Jsonapi={}));
var Jsonapi;!function(o){var s=function(){function s(s,i){this.rsJsonapiConfig=s,this.JsonapiCoreServices=i,this.rootPath="http://reyesoft.ddns.net:9999/api/v1/companies/2",this.resources=[],this.loadingsCounter=0,this.loadingsStart=function(){},this.loadingsDone=function(){},this.loadingsError=function(){},o.Core.Me=this,o.Core.Services=i}return s.$inject=["rsJsonapiConfig","JsonapiCoreServices"],s.prototype._register=function(o){return o.type in this.resources?!1:(this.resources[o.type]=o,!0)},s.prototype.getResource=function(o){return this.resources[o]},s.prototype.refreshLoadings=function(o){this.loadingsCounter+=o,0===this.loadingsCounter?this.loadingsDone():1===this.loadingsCounter&&this.loadingsStart()},s.Me=null,s.Services=null,s}();o.Core=s,angular.module("Jsonapi.services").service("JsonapiCore",s)}(Jsonapi||(Jsonapi={}));
var Jsonapi;!function(t){var e=function(){function e(){this.is_new=!0,this.relationships={}}return e.prototype.clone=function(){var t=new this.constructor;for(var e in this)"object"!=typeof this[e]&&(t[e]=this[e]);return t},e.prototype.register=function(){if(null===t.Core.Me)throw"Error: you are trying register --> "+this.type+" <-- before inject JsonapiCore somewhere, almost one time.";return this.cache={},t.Core.Me._register(this)},e.prototype.getPath=function(){return this.path?this.path:this.type},e.prototype["new"]=function(){var t=this.clone();return t.reset(),t},e.prototype.reset=function(){var t=this;this.id="",this.attributes={},this.relationships={},angular.forEach(this.schema.relationships,function(e,a){t.relationships[a]={},t.relationships[a].data={}}),this.is_new=!0},e.prototype.toObject=function(e){var a=this;e=angular.extend({},t.Base.Params,e),this.schema=angular.extend({},t.Base.Schema,this.schema);var i={},n=[],s=[];angular.forEach(this.relationships,function(t,r){if(a.schema.relationships[r]&&a.schema.relationships[r].hasMany)i[r]={data:[]},angular.forEach(t.data,function(t){var a={id:t.id,type:t.type};i[r].data.push(a);var o=t.type+"_"+t.id;-1===s.indexOf(o)&&-1!==e.include.indexOf(r)&&(s.push(o),n.push(t.toObject({}).data))});else{"id"in t.data||console.warn(r+" defined with hasMany:false, but I have a collection"),i[r]={data:{id:t.data.id,type:t.data.type}};var o=t.data.type+"_"+t.data.id;-1===s.indexOf(o)&&-1!==e.include.indexOf(t.data.type)&&(s.push(o),n.push(t.data.toObject({}).data))}});var r={data:{type:this.type,id:this.id,attributes:this.attributes,relationships:i}};return n.length>0&&(r.included=n),r},e.prototype.get=function(t,e,a,i){return this.__exec(t,e,a,i,"get")},e.prototype["delete"]=function(t,e,a,i){this.__exec(t,e,a,i,"delete")},e.prototype.all=function(t,e,a){return this.__exec(null,t,e,a,"all")},e.prototype.save=function(t,e,a){return this.__exec(null,t,e,a,"save")},e.prototype.__exec=function(e,a,i,n,s){switch(angular.isFunction(a)?(n=i,i=a,a=t.Base.Params):a=angular.isUndefined(a)?t.Base.Params:angular.extend({},t.Base.Params,a),i=angular.isFunction(i)?i:function(){},n=angular.isFunction(n)?n:function(){},this.schema=angular.extend({},t.Base.Schema,this.schema),s){case"get":return this._get(e,a,i,n);case"delete":return this._delete(e,a,i,n);case"all":return this._all(a,i,n);case"save":return this._save(a,i,n)}},e.prototype._get=function(e,a,i,n){var s=this,r=new t.PathMaker;r.addPath(this.getPath()),r.addPath(e),a.include?r.setInclude(a.include):null;var o=this.getService().cache?this.getService().cache[e]:this["new"]();return t.Core.Services.JsonapiHttp.get(r.get()).then(function(e){t.Converter.build(e.data,o,s.schema),s.fillCacheResource(o),i(e)},function(t){n(t)}),o},e.prototype._all=function(e,a,i){var n=this,s=new t.PathMaker;s.addPath(this.getPath()),e.include?s.setInclude(e.include):null;var r={};return this.getService().cache&&(console.log("vamos por la cache",this.getService().cache),angular.forEach(this.getService().cache,function(t,e){r[e]=t})),t.Core.Services.JsonapiHttp.get(s.get()).then(function(e){t.Converter.build(e.data,r,n.schema),n.fillCache(r),a(e)},function(t){i(t)}),r},e.prototype._delete=function(e,a,i,n){var s=new t.PathMaker;s.addPath(this.getPath()),s.addPath(e),t.Core.Services.JsonapiHttp["delete"](s.get()).then(function(t){i(t)},function(t){n(t)})},e.prototype._save=function(e,a,i){var n=this.toObject(e),s=new t.PathMaker;s.addPath(this.getPath()),this.id&&s.addPath(this.id),e.include?s.setInclude(e.include):null;var r=this["new"](),o=t.Core.Services.JsonapiHttp.exec(s.get(),this.id?"PUT":"POST",n);return o.then(function(t){var e=t.data.data;r.attributes=e.attributes,r.id=e.id,a(t)},function(t){i("data"in t?t.data:t)}),r},e.prototype.addRelationship=function(t,e){e=e?e:t.type,e in this.relationships||(this.relationships[e]={data:{}});var a=t.id;a||(a="new_"+Math.floor(1e5*Math.random())),this.relationships[e].data[a]=t},e.prototype.removeRelationship=function(t,e){return t in this.relationships&&"data"in this.relationships[t]&&e in this.relationships[t].data?(delete this.relationships[t].data[e],!0):!1},e.prototype.fillCache=function(t){t.id?this.fillCacheResource(t):this.fillCacheResources(t)},e.prototype.fillCacheResources=function(t){var e=this;angular.forEach(t,function(t){e.fillCacheResource(t)})},e.prototype.fillCacheResource=function(t){t.id&&(this.getService().cache[t.id]=t)},e.prototype.getService=function(){return t.Converter.getService(this.type)},e}();t.Resource=e}(Jsonapi||(Jsonapi={}));

var Jsonapi;!function(i){var n=function(){function i(i){this.JsonapiHttp=i}return i.$inject=["JsonapiHttp"],i}();i.CoreServices=n,angular.module("Jsonapi.services").service("JsonapiCoreServices",n)}(Jsonapi||(Jsonapi={}));
var Jsonapi;!function(n){var o=function(){function n(){}return n.prototype.toObject=function(n){return n},n}();n.JsonapiParser=o}(Jsonapi||(Jsonapi={}));
var Jsonapi;!function(n){var o=function(){function n(){}return n.prototype.get=function(n){},n.prototype.merge=function(n,o){},n}();n.JsonapiStorage=o}(Jsonapi||(Jsonapi={}));